
<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />

        <title>ko-datatables: Examples</title>

        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="translucent black" />

        <!-- bootstrap -->
        <link rel="stylesheet" href="lib/bootstrap.min.css" />
        <!-- flatui -->
        <link rel="stylesheet" href="lib/flat-ui.min.css" />
        <link rel="stylesheet" href="lib/highlight.css" />

        <link rel="stylesheet" href="index.css" />
    </head>
    <body>
        <div class="navigation">
            <nav class="navbar navbar-inverse navbar-embossed navbar-fixed-top" role="navigation">
                <div class="navbar-header">
                    <button class="navbar-toggle"
                        data-target="#navigation-collapse"
                        data-toggle="collapse"
                        type="button">
                        <span class="sr-only">Toggle Navigation</span>
                    </button>
                    <a class="navbar-brand" href="#">ko-datatables</a>
                </div>
                <div id="navigation-collapse" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-left">
                        <li>
                            <a href="https://github.com/EikosPartners/ko-datatables">
                                <span class="fui-github"></span>
                                Source
                            </a>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <span class="fui-list-thumbnailed"></span>
                                Examples
                                <span class="navbar-unread">1</span>
                            </a>
                            <span class="dropdown-arrow"></span>
                            <ul class="dropdown-menu">
                                <li><a href="#example-zero">Zero Configuration</a></li>
                                <li><a href="#example-cols">Column Specification</a></li>
                                <li><a href="#example-temp">Custom Global Templates</a></li>
                                <li><a href="#example-tmpl">Custom Local Templates</a></li>
                                <li><a href="#example-rowa">Row Access</a></li>
                                <li><a href="#example-psel">Pseudo Selection</a></li>
                                <li><a href="#example-rows">Row Selection Model</a></li>
                                <li><a href="#example-mrws">Multi Row Selection Model</a></li>
                                <li><a href="#example-cels">Cell Selection Model</a></li>
                                <li><a href="#example-mcls">Multi Cell Selection Model</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <span class="fui-document"></span>
                                API
                            </a>
                            <span class="dropdown-arrow"></span>
                            <ul class="dropdown-menu">
                                <li><a href="./out/ko-datatables/1.0.0/index.html">v1.0.0</a></li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form navbar-right" role="search" action="#">
                        <div class="form-group">
                            <div class="input-group">
                                <input id="navbarInput-01" class="form-control" type="search" placeholder="Search" />
                                <span class="input-group-btn">
                                    <button class="btn" type="submit">
                                        <span class="fui-search">
                                        </span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
            </nav>
        </div>

        <div class="headline container">
            <h1>ko-datatables</h1>
            <small>A Knockout component for DataTables</small>
        </div>

        <!-- jquery -->
        <script src="lib/jquery.js"></script>
        <!-- bootstrap
        <script src="lib/bootstrap.min.js"></script>
        <! flatui -->
        <script src="lib/flat-ui.min.js"></script>

        <script>
            $(".input-group").each(function ( ) {
                var $this = $(this);
                $this.children("input").on("focus", function ( ) {
                    $this.addClass("focus");
                }).on("blur", function ( ) {
                    $this.removeClass("focus");
                });
            });
        </script>

        <!-- datatables dependencies -->
        <script src="lib/jquery.dataTables.js"></script>
        <script src="lib/knockout.debug.js"></script>

        <!-- -->
        <script src="https://rawgit.com/eikospartners/ko-datatables/develop/kodt.js"></script>
        <!-- local
        <script src="../ko-datatables/kodt.js"></script>
        -->
        <script>
            // override input templates
            var old_string = ko.grid.templates[ko.grid.TYPE_STRING];
            ko.grid.templates[ko.grid.TYPE_STRING] = function ( ) {
                return old_string.call(this).replace("<input", "<input class=\"form-control\" ");
            };
            var old_checkbox = ko.grid.templates[ko.grid.TYPE_CHECKBOX];
            ko.grid.templates[ko.grid.TYPE_CHECKBOX] = function ( ) {
                return "<label class=\"checkbox\">" +
                    old_checkbox.call(this).replace("<input",
                        "<input class=\"custom-checkbox\" data-toggle=\"checkbox\" ") +
                    "<span class=\"icons\">" +
                        "<span class=\"icon-unchecked\"><\/span>" +
                        "<span class=\"icon-checked\"><\/span>" +
                    "<\/span>" +
                "<\/label>";
            };
        </script>
        <div class="data container">
            <script src="lib/random.js"></script>
            <script id="data">
                (function ( ) {
                    var data, generators, index, noise, v;

                    window.data = data = {
                        mock: [ ]
                    ,   perf: [ ]
                    };

                    window.generators = generators = {
                        mock: function ( index ) {
                            return {
                                _index      : index
                            ,   _id         : random.string("[l{4}][i(9){2}]").toUpperCase()
                            ,   guid        : random.string("[a{8}]-[a{4}]-[a{4}]-[a{4}]-[a{12}]")
                            ,   isActive    : random.bool()
                            ,   balance     : parseFloat(random.number(500, 4000).toFixed(2))
                            ,   age         : random.integer(12, 88)
                            ,   registered  : random.date()
                            };
                        }
                    };

                    for (index = 0; index < 100; index++) {
                        data.mock.push(generators.mock(index));
                    }

                    noise = function ( data, gen, freq ) {
                        var index, row, key, d;
                        for (index in data) {
                            if (Math.random() < freq) {
                                row = data[index];
                                d = gen();
                                for (key in d) {
                                    if (key[0] !== "_") {
                                        if (row[key] instanceof Function) {
                                            row[key](d[key]);
                                        } else {
                                            row[key] = d[key];
                                        }
                                    }
                                }
                            }
                        }
                    }

                    window.noise = function ( set, freq, timeout ) {
                        if (v) {
                            window.clearInterval(v);
                        }
                        if (!timeout || timeout < 0) {
                            v = null;
                            noise(data[set], generators[set], freq);
                        } else {
                            v = setInterval(function () {
                                noise(data[set], generators[set], freq);
                            }, timeout);
                        }
                    };
                    window.mock_noise = window.noise.bind(null, "mock");

                })();
            </script>
        </div>
        <div class="content container">
            <div id="example-zero" data="mock" class="no-info">
                <h5 id="example-zero-title">Zero Configuration</h5>
                <script id="example-zero-script">
                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-zero-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 10) }
                        });
                    });
                </script>
                <table id="example-zero-content"></table>
            </div>
            <div id="example-cols" class="no-info">
                <h5 id="example-cols-title">Column Specification</h5>
                <script id="example-cols-script">
                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-cols-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   columnModels: [
                                { name: "isActive", title: "Active",         type: "checkbox", object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true }
                            ,   { name: "age",      title: "Age",            type: "text",     object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true }
                            ]
                        });
                    });
                </script>
                <table id="example-cols-content"></table>
            </div>
            <div id="example-temp" class="no-info">
                <h5 id="example-temp-title">Custom Global Templates</h5>
                <script id="example-temp-script">
                    ko.grid.templates["toggle"] = function (  ) {
                        return "<div class='bootstrap-switch-square'>\
                            <input type='checkbox'\
                                data-toggle='switch'\
                                data-on-text='Yes'\
                                data-off-text='No'\
                                data-bind='checked:value'\/>\
                        <\/div>";
                    };

                    ko.grid.templates["progress"] = function ( ) {
                        return "<div class='progress'>\
                            <div class='progress-bar'\
                                data-bind='style:{width:value() + \"%\"}'\
                            ><\/div> \
                        <\/div>";
                    };

                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-temp-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   columnModels: [
                                { name: "isActive", title: "Active",         type: "toggle",   object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true }
                            ,   { name: "age",      title: "Completion",     type: "progress", object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true }
                            ]
                        });

                        window.setTimeout(function ( ) {
                            $("[data-toggle=\"switch\"]").bootstrapSwitch();
                        });
                    });
                </script>
                <table id="example-temp-content"></table>
            </div>
            <div id="example-tmpl" class="no-info">
                <h5 id="example-tmpl-title">Custom Local Templates</h5>
                <script type="text/html" id="tmpl_temp">
                    <!-- ko foreach:value().split("-") -->
                        <code data-bind="text:$data.toUpperCase()"></code>
                    <!-- /ko -->
                </script>
                <script id="example-tmpl-script">
                    window.format_dollar = function ( n ) {
                        var
                            // get digits after decimal to show
                            d = n % 1 > 0 ? 2 : 0,
                            // get sign
                            s = n < 0,
                            // get integer fixed to 0 as string and set n to fixed to d
                            i = String(parseInt(n = Math.abs(+n || 0).toFixed(d))),
                            // get number of digits before first comma (12333) -> 2
                            j = (j = i.length) > 3 ? j % 3 : 0;
                            // start with sign, add digits before first command and a comma
                        return (s ? '(' : '') + '$' + (j ? i.substr(0, j) + ',' : '') +
                            // get all digits after first comma, before decimal
                            i.substr(j).replace(/(\d{3})(?=\d)/g, '$1,') +
                            // get all digits after decimal if wanted
                            (d ? '.' + Math.abs(n - i).toFixed(d).slice(2) : '')
                            + (s ? ')' : '');
                    };
                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-tmpl-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   columnModels: [
                                { name: "isActive", title: "Active",         type: "checkbox", object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true, template: "tmpl_temp" }
                            ,   { name: "age",      title: "Age",            type: "progress", object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true,
                                    template: "<span data-bind=\"text:format_dollar(value())\"></span>" }
                            ]
                        });
                    });
                </script>
                <table id="example-tmpl-content"></table>
            </div>
            <div id="example-rowa" class="no-info">
                <h5 id="example-rowa-title">Row Access</h5>
                <script id="example-rowa-script">
                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-rowa-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   oncreaterow: function ( row ) {
                                var active, node = $(row.node());
                                (active = row.data().isActive).subscribe(function ( change ) {
                                    node[(change ? "add" : "remove") + "Class"]("highlight");
                                });
                                // force update
                                active.notifySubscribers(active());
                        },  columnModels: [
                                { name: "isActive", title: "Active",         type: "checkbox", object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true, template: "tmpl_temp" }
                            ,   { name: "age",      title: "Age",            type: "progress", object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true,
                                    template: "<span data-bind=\"text:format_dollar(value())\"></span>" }
                            ]
                        });
                    });
                </script>
                <table id="example-rowa-content"></table>
            </div>
            <div id="example-psel" class="no-info">
                <h5 id="example-psel-title">Pseudo Selection</h5>
                <script id="example-psel-script">
                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-psel-content");
                        element.setAttribute("data-bind", "grid:$data");

                        selected = ko.observableArray([ ]);

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   oncreaterow: function ( row ) {
                                var active, node = $(row.node()), data;

                                (active = (data = row.data()).isActive).subscribe(function ( change ) {
                                    if (change) {
                                        node.addClass("highlight");
                                        selected.push(data);
                                    } else {
                                        node.removeClass("highlight");
                                        selected.remove(data);
                                    }
                                });
                                // force update
                                active.notifySubscribers(active());
                        },  columnModels: [
                                { name: "_index",   title: "",               type: "text",     object: true }
                            ,   { name: "isActive", title: "Active",         type: "checkbox", object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true, template: "tmpl_temp" }
                            ,   { name: "age",      title: "Age",            type: "progress", object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true,
                                    template: "<span data-bind=\"text:format_dollar(value())\"></span>" }
                            ]
                        });

                        element = document.getElementById("example-psel-selected-code");

                        ko.computed(function ( ) {
                            element.innerHTML = selected().map(function ( item ) {
                                return item._index();
                            }).toString().replace(/,/g, ", ");
                        });
                    });
                </script>
                <span id="example-psel-selected">
                    <pre><code class="json" id="example-psel-selected-code"></code></pre>
                </span>
                <table id="example-psel-content"></table>
            </div>
            <div id="example-rows" class="no-info">
                <h5 id="example-rows-title">Row Selection Model</h5>
                <script id="example-rows-script">
                    window.setTimeout(function ( ) {
                        var element, selement;

                        element = document.getElementById("example-rows-content");
                        element.setAttribute("data-bind", "grid:$data");

                        selement = document.getElementById("example-rows-selected-code");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   selectionModels: [
                                new ko.grid.RowSelectionModel({
                                    onchange: function ( row ) {
                                        selement.innerHTML = (row) ? row.data()._index() : "None";
                                    }
                                })
                            ]
                        ,   columnModels: [
                                { name: "_index",   title: "",               type: "text",     object: true }
                            ,   { name: "isActive", title: "Active",         type: "checkbox", object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true, template: "tmpl_temp" }
                            ,   { name: "age",      title: "Age",            type: "progress", object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true,
                                    template: "<span data-bind=\"text:format_dollar(value())\"></span>" }
                            ]
                        });
                    });
                </script>
                <span id="example-rows-selected">
                    <pre><code class="json" id="example-rows-selected-code">None</code></pre>
                </span>
                <table id="example-rows-content"></table>
            </div>
            <div id="example-mrws" class="no-info">
                <h5 id="example-mrws-title">Multi Row Selection Model</h5>
                <script id="example-mrws-script">
                    window.setTimeout(function ( ) {
                        var element, selement;

                        element = document.getElementById("example-mrws-content");
                        element.setAttribute("data-bind", "grid:$data");

                        selement = document.getElementById("example-mrws-selected-code");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   selectionModels: [
                                new ko.grid.MultiRowSelectionModel({
                                    onchange: function ( rows ) {
                                        selement.innerHTML = (rows.length)
                                            ? rows.map(function ( row ) {
                                                return row.data()._index();
                                            }).toString() : "None";
                                    }
                                })
                            ]
                        ,   columnModels: [
                                { name: "_index",   title: "",               type: "text",     object: true }
                            ,   { name: "isActive", title: "Active",         type: "checkbox", object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true, template: "tmpl_temp" }
                            ,   { name: "age",      title: "Age",            type: "progress", object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true,
                                    template: "<span data-bind=\"text:format_dollar(value())\"></span>" }
                            ]
                        });
                    });
                </script>
                <span id="example-mrws-selected">
                    <pre><code class="json" id="example-mrws-selected-code">None</code></pre>
                </span>
                <table id="example-mrws-content"></table>
            </div>
        </div>

        <script src="lib/highlight.pack.js"></script>
        <script>
            window.setTimeout(function ( ) {
                $("#data").each(function (  ) {
                    var $this = $(this)
                    ,   pre = $("<pre class=\"collapse\" style=\"height:0\">")
                    ,   code = $("<code class=\"js\">")
                    ,   btn = $("<a class=\"btn btn-primary pull-right\" " +
                        "href=\"#\">View Data<\/a>")
                    ,   state = false;
                    code.html($this
                        .html()
                        .split("\n")
                        .map(function ( string, index ) {
                            return string.substr(12);
                        })
                        .join("\n")
                    );

                    btn.click(function ( ) {
                        state = !state;
                        if (state) {
                            btn.text("Hide Data");
                        } else {
                            btn.text("Show Data");
                        }
                        pre.collapse("toggle");
                    });

                    pre.append(code);
                    $(this).after(pre);
                    pre.after(btn);
                    hljs.highlightBlock(pre[0]);
                });
            });
            window.setTimeout(function ( ) {
                $(".content>div").each(function (  ) {
                    var id = $(this).attr("id")
                    ,   data = $(this).attr("data")
                    ,   pre = $("<pre class=\"collapse\" style=\"height:0\">")
                    ,   code = $("<code class=\"js\">")
                    ,   src = $("<a class=\"btn btn-primary pull-right\" " +
                        "href=\"#\">View Source<\/a>")
                    ,   noise = $("<a class=\"btn btn-primary pull-right noise\" " +
                        "href=\"#\">Noise<\/a>")
                    ,   state = false
                    code.html($("#" + id + "-script")
                        .html()
                        .split("\n")
                        .map(function ( string, index ) {
                            return string.substr(20)
                                .replace(/\>/g, "&gt;")
                                .replace(/\</g, "&lt;");
                        })
                        .join("\n")
                    );
                    pre.append(code);
                    $("#" + id + "-content").parent().after(pre);
                    pre.after(src);
                    if (data) {
                        pre.after(noise);
                    }
                    src.click(function ( e ) {
                        e.preventDefault();
                        state = !state;
                        if (state) {
                            src.text("Hide Source");
                        } else {
                            src.text("View Source");
                        }
                        pre.collapse("toggle");
                    });
                    noise.click(function ( e ) {
                        e.preventDefault();
                        window.noise(data,
                            random.number(0.2, 0.6),
                            random.number(100, 600));
                    });
                    hljs.highlightBlock(pre[0]);

                });
            });
        </script>

    </body>
</html>

