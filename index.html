
<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />

        <title>ko-datatables: Examples</title>

        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="translucent black" />

        <!-- bootstrap -->
        <link rel="stylesheet" href="lib/bootstrap.min.css" />
        <!-- flatui -->
        <link rel="stylesheet" href="lib/flat-ui.min.css" />
        <link rel="stylesheet" href="lib/highlight.css" />

        <link rel="stylesheet" href="index.css" />
    </head>
    <body>
        <div class="navigation">
            <nav class="navbar navbar-inverse navbar-embossed navbar-fixed-top" role="navigation">
                <div class="navbar-header">
                    <button class="navbar-toggle"
                        data-target="#navigation-collapse"
                        data-toggle="collapse"
                        type="button">
                        <span class="sr-only">Toggle Navigation</span>
                    </button>
                    <a class="navbar-brand" href="#">ko-datatables</a>
                </div>
                <div id="navigation-collapse" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-left">
                        <li>
                            <a href="https://github.com/EikosPartners/ko-datatables">
                                <span class="fui-github"></span>
                                Source
                            </a>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <span class="fui-list-thumbnailed"></span>
                                Examples
                                <span class="navbar-unread">1</span>
                            </a>
                            <span class="dropdown-arrow"></span>
                            <ul class="dropdown-menu">
                                <li><a href="#example-zero">Zero Configuration</a></li>
                                <li><a href="#example-cols">Column Specification</a></li>
                                <li><a href="#example-temp">Custom Global Templates</a></li>
                                <li><a href="#example-perf">Performance</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <span class="fui-document"></span>
                                API
                            </a>
                            <span class="dropdown-arrow"></span>
                            <ul class="dropdown-menu">
                                <li><a href="./out/ko-datatables/1.0.0/index.html">v1.0.0</a></li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form navbar-right" role="search" action="#">
                        <div class="form-group">
                            <div class="input-group">
                                <input id="navbarInput-01" class="form-control" type="search" placeholder="Search" />
                                <span class="input-group-btn">
                                    <button class="btn" type="submit">
                                        <span class="fui-search">
                                        </span>
                                    </button>
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
            </nav>
        </div>

        <div class="headline container">
            <h1>ko-datatables</h1>
            <small>A Knockout component for DataTables</small>
        </div>

        <!-- jquery -->
        <script src="lib/jquery.js"></script>
        <!-- bootstrap
        <script src="lib/bootstrap.min.js"></script>
        <! flatui -->
        <script src="lib/flat-ui.min.js"></script>

        <script>
            $(".input-group").each(function ( ) {
                var $this = $(this);
                $this.children("input").on("focus", function ( ) {
                    $this.addClass("focus");
                }).on("blur", function ( ) {
                    $this.removeClass("focus");
                });
            });
        </script>

        <!-- datatables dependencies -->
        <script src="lib/jquery.dataTables.js"></script>
        <script src="lib/knockout.debug.js"></script>

        <script src="https://rawgit.com/eikospartners/ko-datatables/develop/kodt.js"></script>
        <script>
            // override input templates
            var old_string = ko.grid.templates[ko.grid.TYPE_STRING];
            ko.grid.templates[ko.grid.TYPE_STRING] = function ( ) {
                return old_string.call(this).replace("<input", "<input class=\"form-control\" ");
            };
            var old_checkbox = ko.grid.templates[ko.grid.TYPE_CHECKBOX];
            ko.grid.templates[ko.grid.TYPE_CHECKBOX] = function ( ) {
                return "<label class=\"checkbox\">" +
                    old_checkbox.call(this).replace("<input",
                        "<input class=\"custom-checkbox\" data-toggle=\"checkbox\" ") +
                    "<span class=\"icons\">" +
                        "<span class=\"icon-unchecked\"><\/span>" +
                        "<span class=\"icon-checked\"><\/span>" +
                    "<\/span>" +
                "<\/label>";
            };
        </script>
        <div class="data container">
            <script src="lib/random.js"></script>
            <script id="data">
                (function ( ) {
                    var data, generators,
                    now, now_minus_3m, index, noise, v;

                    now = new Date();
                    now_minus_3m = new Date();
                    now_minus_3m.setDate(now_minus_3m.getDate() - 90);

                    window.data = data = {
                        mock: [ ]
                    ,   perf: [ ]
                    };

                    window.generators = generators = {
                        mock: function ( index ) {
                            return {
                                _index      : index
                            ,   _id         : random.string("[l{4}][i(9){2}]").toUpperCase()
                            ,   guid        : random.string("[a{8}]-[a{4}]-[a{4}]-[a{4}]-[a{12}]")
                            ,   isActive    : random.bool()
                            ,   balance     : parseFloat(random.number(500, 4000).toFixed(2))
                            ,   age         : random.integer(12, 88)
                            ,   registered  : random.date(now_minus_3m, now)
                            };
                        },
                        perf: function ( index ) {
                            var id = random.integer(1, 3)
                            ,   price = function ( ) {
                                    return parseFloat(random.number(1000).toFixed(5))
                                }
                            ,   doubles = function ( ) {
                                    var l = random.letter("ABCDEF");
                                    return l + l;
                                }
                            ;
                            return {
                              "rejected"        : random.string("[bool]"),
                              "desc"            : "",
                              "account"         : "acct_" + id,
                              "person"          : "person_acct_" + id,
                              "method"          : "method_acct_" + id,
                              "order_code"      : "S" + doubles(),
                              "order_bcode"     : "X" + doubles(),
                              "order_type"      : "STOP",
                              "_order_id"        : index,
                              "quant"           : random.integer(1000),
                              "quant_filled"    : random.integer(1000),
                              "quant_last"      : random.integer(1000),
                              "quant_open"      : random.integer(1000),
                              "price_limit"     : price(),
                              "price_last"      : price(),
                              "price_stop"      : price(),
                              "price"           : price(),
                              "venue"           : "V" + doubles(),
                              "gateway"         : "G" + doubles(),
                              "price_average"   : price(),
                              "currency"        : "USD",
                              "side"            : random.choose(["BUY","SELL"]),
                              "tif"             : "TIF",
                              "reject_reason"   : random.choose(["", "REJECTED"]),
                              "state"           : random.choose(["NEW", "PARTIAL"]),
                              "event"           : "REPORT",
                              "time_transaction": random.date().toISOString(),
                              "time_streamer"   : random.date().toISOString(),
                              "time_middleware" : random.date().toISOString(),
                              "manual"          : random.choose(["NO", "YES"]),
                              "id_original"     : random.integer(10000),
                              "time_placement"  : random.date().toISOString()
                            }
                        }
                    };

                    for (index = 0; index < 100; index++) {
                        data.mock.push(generators.mock(index));
                    }
                    for (index = 0; index < 50; index++) {
                        data.perf.push(generators.perf(index));
                    }

                    noise = function ( data, gen, freq ) {
                        var index, row, key, d;
                        for (index in data) {
                            if (Math.random() < freq) {
                                row = data[index];
                                d = gen();
                                for (key in d) {
                                    if (key[0] !== "_") {
                                        if (row[key] instanceof Function) {
                                            row[key](d[key]);
                                        } else {
                                            row[key] = d[key];
                                        }
                                    }
                                }
                            }
                        }
                    }

                    window.noise = function ( set, freq, timeout ) {
                        if (v) {
                            window.clearInterval(v);
                        }
                        if (!timeout || timeout < 0) {
                            v = null;
                            noise(data[set], generators[set], freq);
                        } else {
                            v = setInterval(function () {
                                noise(data[set], generators[set], freq);
                            }, timeout);
                        }
                    };
                    window.mock_noise = window.noise.bind(null, "mock");
                    window.perf_noise = window.noise.bind(null, "perf");

                })();


            </script>

        </div>

        <div class="content container">
            <div id="example-zero" data="mock">
                <h5 id="example-zero-title">Zero Configuration</h5>
                <script id="example-zero-script">
                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-zero-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 10) }
                        });
                    });
                </script>
                <table id="example-zero-content"></table>
            </div>
            <div id="example-cols">
                <h5 id="example-cols-title">Column Specification</h5>
                <script id="example-cols-script">
                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-cols-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   columnModels: [
                                { name: "isActive", title: "Active",         type: "checkbox", object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true }
                            ,   { name: "age",      title: "Age",            type: "text",     object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true }
                            ]
                        });
                    });
                </script>
                <table id="example-cols-content"></table>
            </div>
            <div id="example-temp">
                <h5 id="example-temp-title">Custom Global Templates</h5>
                <script id="example-temp-script">
                    ko.grid.templates["toggle"] = function (  ) {
                        return "<div class='bootstrap-switch-square'>       \
                            <input type='checkbox'                          \
                                data-toggle='switch'                        \
                                data-on-text='Yes'                          \
                                data-off-text='No'                          \
                                data-bind='checked:" + this.value + "'\/>   \
                        <\/div>";
                    };

                    ko.grid.templates["progress"] = function ( ) {
                        return "<div class='progress'>                      \
                            <div class='progress-bar'                       \
                                data-bind='style:{width:" +
                                this.value + "() + \"%\"}'                  \
                            ><\/div> \
                        <\/div>";
                    };

                    window.setTimeout(function ( ) {
                        var element;

                        element = document.getElementById("example-temp-content");
                        element.setAttribute("data-bind", "grid:$data");

                        ko.applyBindingsToNode(element, null, {
                            dataModel: { rows: window.data.mock.slice(0, 5) }
                        ,   columnModels: [
                                { name: "isActive", title: "Active",         type: "toggle",   object: true }
                            ,   { name: "guid",     title: "Identification", type: "text",     object: true }
                            ,   { name: "age",      title: "Completion",            type: "progress", object: true }
                            ,   { name: "balance",  title: "Balance",        type: "text",     object: true }
                            ]
                        });

                        window.setTimeout(function ( ) {
                            $("[data-toggle=\"switch\"]").bootstrapSwitch();
                        });
                    });
                </script>
                <table id="example-temp-content"></table>
            </div>
            <div id="example-perf" data="perf">
                <h5 id="example-perf-title">Performance</h5>
                <script id="example-perf-script">
                    window.setTimeout(function ( ) {
                        var element, dm, other = [  ], index;

                        element = document.getElementById("example-perf-content");
                        element.setAttribute("data-bind", "grid:$data");

                        dm = new ko.grid.DataModel({
                            rows: window.data.perf
                        });

                        ko.applyBindingsToNode(element, null, {
                            options: { paging:false, dom:"t" }
                        ,   dataModel: dm
                        });

                        for ( index = 50; index < 100; index++ ) {
                            other.push(generators.perf(index));
                        }

                        setInterval(function (  ) {
                            dm.rows.push(other.pop());
                        }, 5000);
                    });
                </script>
                <table id="example-perf-content"></table>
            </div>
        </div>

        <script src="lib/highlight.pack.js"></script>
        <script>
            window.setTimeout(function ( ) {
                $("#data").each(function (  ) {
                    var $this = $(this)
                    ,   pre = $("<pre class=\"collapse\" style=\"height:0\">")
                    ,   code = $("<code class=\"js\">")
                    ,   btn = $("<a class=\"btn btn-primary pull-right\" " +
                        "href=\"#\">View Data<\/a>")
                    ,   state = false;
                    code.html($this
                        .html()
                        .split("\n")
                        .map(function ( string, index ) {
                            return string.substr(12);
                        })
                        .join("\n")
                    );

                    btn.click(function ( ) {
                        state = !state;
                        if (state) {
                            btn.text("Hide Data");
                        } else {
                            btn.text("Show Data");
                        }
                        pre.collapse("toggle");
                    });

                    pre.append(code);
                    $(this).after(pre);
                    pre.after(btn);
                    hljs.highlightBlock(pre[0]);
                });
            });
            window.setTimeout(function ( ) {
                $(".content>div").each(function (  ) {
                    var id = $(this).attr("id")
                    ,   data = $(this).attr("data")
                    ,   pre = $("<pre class=\"collapse\" style=\"height:0\">")
                    ,   code = $("<code class=\"js\">")
                    ,   src = $("<a class=\"btn btn-primary pull-right\" " +
                        "href=\"#\">View Source<\/a>")
                    ,   noise = $("<a class=\"btn btn-primary pull-right noise\" " +
                        "href=\"#\">Noise<\/a>")
                    ,   state = false
                    code.html($("#" + id + "-script")
                        .html()
                        .split("\n")
                        .map(function ( string, index ) {
                            return string.substr(16)
                                .replace(/\>/g, "&gt;")
                                .replace(/\</g, "&lt;");
                        })
                        .join("\n")
                    );
                    pre.append(code);
                    $("#" + id + "-content").parent().after(pre);
                    pre.after(src);
                    if (data) {
                        pre.after(noise);
                    }
                    src.click(function ( e ) {
                        e.preventDefault();
                        state = !state;
                        if (state) {
                            btn.text("Hide Source");
                        } else {
                            btn.text("View Source");
                        }
                        pre.collapse("toggle");
                    });
                    noise.click(function ( e ) {
                        e.preventDefault();
                        window.noise(data,
                            random.number(0.2, 0.6),
                            random.number(100, 600));
                    });
                    hljs.highlightBlock(pre[0]);

                });
            });
        </script>

    </body>
</html>

